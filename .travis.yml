language: cpp

sudo: enabled

matrix:
  include:
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
      env:
        - MATRIX_EVAL="CC=gcc-5 && CXX=g++-5"

# Install tools
before_install:
  - eval "${MATRIX_EVAL}"
  - mkdir build && cd build
  - CMAKE_RELEASE_NAME=cmake-3.8.2-Linux-x86_64
  - wget https://cmake.org/files/v3.8/${CMAKE_RELEASE_NAME}.tar.gz
  - tar -xf ${CMAKE_RELEASE_NAME}.tar.gz
  - CMAKE=`pwd`/${CMAKE_RELEASE_NAME}/bin/cmake
  - CTEST=`pwd`/${CMAKE_RELEASE_NAME}/bin/ctest

# Build the project
script:
  - ${CMAKE} -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_COMPILER=g++-5 -DCMAKE_C_COMPILER=gcc-5 ..
  - make
  - ${CTEST}

before_deploy:
  - APP_PATH="`pwd`/src/app/poly-calc-app"
  - GITHUB_API_KEY="Rn9AMo8PB4zR3C0a/d23nWcUFOlFzswTDEKMwbi+oFOJxULXMfVJvxhRfdqf4HKRUCX/sdDmLfg8QU/b1IT/09oRnWaf9TBZD0P79yr8wyRro3zNgkNKshqtd1nyVFSHWgOA8Cnt0RUpGqJo6eL7S8PWTnzkB94pECdGBTpFvo/t15ENxfnQdYKatmBkpEd/EW2OqAv9XoLeSMxNSjsjFodeIglf4nfD1XFWLej/O1csmWanPWM2Pb3YOnAu/jM2kQ/gE9oIUQXQCMwwwKxXXn/oVuodu+29j6aFzxPCe0CvFLyI+ilA6fT6lyLMkGoBbAr6NPdlnUgbNVuq7iVgx4Wa1hRMfa0I8r4JnvwSqjQq6JCZyzNTc3/ZPJ9upponpGtK6Wi31Y6FgFU6E+Yp6fHAHiitZ11xw4KBJemAZ1cX90qGUbhhI4u1cLCy/MYBH+KHlgYKAUyJXdtg7VjnTIuhGQYm27GxnbyTQhSv2HbCwmbLmhOgijxfxFumLVD7esPLbxj5CuW2M6lp1tJUvcfOCdryoVzGuEwQUUf6lgjY98paEtTVHGqK8Fbd6utBxVN4KeR9no1FAjAIYUTeAiIjm3chIsZe/gAoliJ3MzTbsXl1UR9W7ifA5U7aZFLceb3VGQkpzbm17upSEE1+Gl7oJkxAjJN3y34uTUzF2ec="

deploy:
  provider: releases
  api_key:
    secure: ${GITHUB_API_KEY}
  file: ${APP_PATH}
  skip_cleanup: true
  on:
    tags: true
